@page "/";
@using DatabaseLibrary.Database.Reviews;

@inject NavigationManager navManager;
@inject ISnackbar snackBar;
@inject IUserRepository userRepository;
@inject IReviewRepository reviewRepository;



<PageTitle>Home</PageTitle>

<AuthorizeView>
    <Authorized>
        <MudText Typo="Typo.h3" GutterBottom="true">Hello, @context.User.Identity.Name!</MudText>
    </Authorized>
    <NotAuthorized>
        <MudText Typo="Typo.h3" GutterBottom="true">Hello, Guest</MudText>
    </NotAuthorized>
</AuthorizeView>

<MudText Class="mb-8">Welcome to <b>The Garage</b>, <b>The Garage</b> is the garage for reparing your vehicles!</MudText>
<AuthorizeView>
    <Authorized>
        <MudText>Let other customers know what you think of us!</MudText>
        <MudText>We would gladly aprachiate if you left a review!</MudText>
        <ReviewCard Writing="true"/>
    </Authorized>
</AuthorizeView>
@if (Reviews.Count() > 0)
{
    <MudText Class="mb-8">See what other customers think:</MudText>
    <br/>
    <MudExpansionPanel Text="Reviews">
        @foreach (var review in Reviews)
        {
            <ReviewCard Review="review" />
        }
    </MudExpansionPanel>
}

@code{
    public List<Review> Reviews = new List<Review>();

    protected override async Task OnInitializedAsync()
    {
        List<Review> reviews = await reviewRepository.GetReviewsByFilter();
        Reviews = reviews.OrderBy(r => r.DatePosted).OrderBy(r => r.ReviewStars).ToList();
    }
}